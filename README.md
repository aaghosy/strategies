# 三角套利策略 (Triangular Arbitrage Strategy)

一个基于 FMZ 量化交易平台的加密货币三角套利策略实现。

## 📌 项目简介

本项目实现了一个自动化的三角套利策略，通过监控三个交易对之间的价格差异来寻找套利机会。当发现价格不一致时，策略会自动计算潜在利润并扣除交易手续费。

## 🎯 功能特性

- ✅ **实时深度数据获取**：从交易所获取买一/卖一价格和成交量
- ✅ **双向套利识别**：自动识别两种套利路径
- ✅ **手续费计算**：精确计算交易手续费，确保盈利
- ✅ **数据验证**：完善的空值检查和异常处理
- ✅ **日志输出**：详细的交易日志，便于监控和调试

## 📊 策略逻辑

假设有三个交易对：
- P1: A/B
- P2: B/C  
- P3: A/C

### 套利路径

**路径1**：当 `p1_sale_price / p2_sale_price < p3_sale_price` 时
- 买入 P1 → 卖出 P2 → 卖出 P3

**路径2**：当 `p1_sale_price / p2_sale_price > p3_sale_price` 时
- 卖出 P3 → 买入 P2 → 买入 P1

## 🚀 使用方法

### 在 FMZ 平台上部署

1. 登录 [FMZ 量化交易平台](https://www.fmz.com/)
2. 创建新策略
3. 将 `策略.py` 的代码复制到策略编辑器
4. 配置交易所和交易对
5. 设置交易参数（交易量、手续费率等）
6. 回测或实盘运行

### 代码示例

```python
# 创建市场对象
market = fmz_market()

# 计算利润（交易量100，手续费0.1%）
profit = market.profit_calculation(amount=100, tax_rate=0.001)

# 循环监控套利机会
market.profit_calculation_circle()
```

## 📁 代码结构

```
fmz_market/
├── basic_market_data(idx)           # 获取指定交易对的深度数据
│   ├── 参数：idx (0/1/2) 交易所索引
│   └── 返回：包含买一卖一价格和成交量的字典
│
├── profit_calculation(amount, tax_rate)  # 计算套利利润
│   ├── 参数：
│   │   ├── amount: 交易量
│   │   └── tax_rate: 手续费率 (如 0.001 = 0.1%)
│   └── 返回：预期利润
│
└── profit_calculation_circle()      # 循环监控套利机会
    └── 持续运行10000次计算
```

## ⚙️ 配置说明

### 必需的 FMZ 全局变量
- `exchanges`: 交易所对象列表
- `Log`: FMZ 日志输出函数

### 建议配置
- 交易对数量：3个（形成套利三角）
- 最小利润阈值：建议 > 0.3%（覆盖手续费和滑点）
- 手续费率：根据实际交易所设置（一般 0.1% - 0.2%）

## ⚠️ 风险提示

1. **市场风险**：加密货币市场波动剧烈，套利窗口可能瞬间消失
2. **滑点风险**：实际成交价格可能与预期不符
3. **流动性风险**：当前代码获取了成交量数据但未完全应用于限制
4. **技术风险**：网络延迟、API限制等可能影响执行

## 🔧 待改进功能

- [ ] 完善流动性检查逻辑
- [ ] 添加滑点保护
- [ ] 实现自动下单功能
- [ ] 优化手续费计算公式
- [ ] 添加止损机制
- [ ] 支持更多交易对组合
- [ ] 添加性能统计和收益报告

## 📝 注意事项

### 变量命名说明
```python
p1_sale_price = p1_depth['bid_price']  # 卖出价（bid，我方卖出时的价格）
p1_buy_price = p1_depth['ask_price']   # 买入价（ask，我方买入时的价格）
```

### 手续费计算
当前公式包含多个交易环节的手续费，请根据实际交易所规则调整。

## 📚 相关资源

- [FMZ 量化交易平台](https://www.fmz.com/)
- [FMZ API 文档](https://www.fmz.com/api)
- [三角套利原理介绍](https://en.wikipedia.org/wiki/Triangular_arbitrage)

## 📄 许可证

本项目仅供学习和研究使用，请勿用于非法用途。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

⚡ **免责声明**：本策略仅供学习研究，不构成投资建议。量化交易存在风险，请谨慎使用实盘资金。
